# Как повысить Performance (Lighthouse)

По отчёту Lighthouse основные причины низкого балла (66) и что делать.

---

## 1. Самый большой эффект: картинка LCP (~5 MB PNG)

**Проблема:** Hero-изображение `hero-banner.png` — это элемент LCP (Largest Contentful Paint). Сейчас это тяжёлый PNG, LCP ~8 с.

**Что сделать (по приоритету):**

- **Перевести в WebP (и при возможности AVIF).** Оценка Lighthouse: экономия ~8,6 MB. Создать `hero-banner.webp` (и при желании `hero-banner.avif`), в Hero выводить через `<picture>`:
  ```html
  <picture>
    <source srcSet="hero-banner.avif" type="image/avif" />
    <source srcSet="hero-banner.webp" type="image/webp" />
    <img src={heroBannerPng} alt="..." fetchPriority="high" />
  </picture>
  ```
- **Уменьшить размер по ширине/высоте.** В Hero блок показывается в ограниченной ширине (например, до ~ половины экрана). Достаточно картинки шириной ~800–1200 px; ресайз + сжатие сильно уменьшат вес.
- **Оставить preload для LCP-картинки.** В сборке уже есть preload для hero-изображения; при переходе на WebP нужно в плагине в `vite.config.ts` подставлять preload для `.webp` (или того формата, который реально отдаётся первым).

После этих шагов LCP и общий Performance должны заметно вырасти.

---

## 2. Render-blocking ресурсы (~1,95 с)

**Проблема:** CSS (и при необходимости JS) блокируют первую отрисовку.

**Что сделать:**

- **Критичный CSS:** вынести стили «выше сгиба» (хедер, hero, шрифты) в отдельный файл и подключать его первым или инлайнить в `<head>`. Остальной CSS подгружать асинхронно (например, `media="print" onload="this.media='all'"` или через JS).
- **Шрифты:** уже есть `font-display: swap`; при желании — preload только того шрифта, который используется на первом экране.
- **JS:** основной бандл уже разбит (lazy секции); убедиться, что скрипты без `defer`/`async` только там, где нужны для первого рендера.

---

## 3. Общий вес страницы (~12 MB)

**Проблема:** Много веса дают изображения и видео.

**Что сделать:**

- **Картинки:** перевести крупные PNG/JPEG в WebP (и по возможности AVIF) — не только hero, но и слайды Cargo, сертификация, доставка и т.д. Можно конвертировать вручную или через скрипт/пайплайн при сборке.
- **Видео:** уже используется `preload="metadata"` — хорошо; не грузить лишние видео до взаимодействия. При возможности — заменить самые тяжёлые ролики на более сжатые или более короткие версии.
- **Размеры изображений:** отдавать картинки в том разрешении, в котором они показываются (например, `srcset` + `sizes` для ресайза под разные экраны), чтобы не тянуть лишние мегабайты.

---

## 4. Unused CSS / JavaScript

**Проблема:** Lighthouse ругается на неиспользуемые правила CSS и JS.

**Что сделать:**

- **CSS:** если используется Tailwind — убедиться, что в production включён purge/content и собирается только используемый CSS. При необходимости — вынести редко используемые блоки в отдельные файлы и подгружать по мере надобности.
- **JS:** дерево уже разбито (lazy-секции); проверить, что в основной чанк не попадают большие библиотеки, нужные только в одной секции.

---

## 5. Сделанные оптимизации

- **Hero в WebP:** из `hero-banner.png` при сборке генерируется `hero-banner.webp` (скрипт `scripts/generate-hero-webp.mjs`, ресайз до 1400px, quality 82). В Hero используется `<picture>`: сначала WebP, fallback — PNG. Preload в `index.html` указывает на WebP. Размер LCP-картинки снижен с ~5 MB до ~30 KB.
- **`fetchPriority="high"`** у hero-картинки для приоритетной загрузки LCP.
- Preload hero (WebP) и шрифта через плагин сборки.
- Ниже сгиба у изображений — **`loading="lazy"`**.
- У видео в WhySection — **`preload="metadata"`**.
- **Tailwind:** в `content` указан `./src/**/*.{ts,tsx}` — purge охватывает все компоненты.

---

## Итог по приоритетам

| Приоритет | Действие | Ожидаемый эффект |
|-----------|----------|-------------------|
| 1 | Hero (и другие крупные картинки) в WebP + ресайз под экран | Сильное снижение LCP и общего веса |
| 2 | Критичный CSS / отложенная загрузка остального CSS | Ускорение FCP, меньше блокировки |
| 3 | Остальные изображения в WebP, при необходимости `srcset` | Меньший total byte weight, лучше Performance |
| 4 | Проверка Tailwind purge и лишнего JS | Небольшой выигрыш по размеру и времени парсинга |

После изменений имеет смысл снова прогнать Lighthouse и сравнить балл Performance и метрики (FCP, LCP, TBT, CLS).
