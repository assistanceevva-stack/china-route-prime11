# План оптимизации и реорганизации China Route Prime  
## Утверждённая версия (с учётом одобренных рекомендаций)

**Статус:** одобрено к выполнению.  
**Порядок:** Этап 1 → Этап 2 → Этап 3 → Этап 4.

---

## Цели

- Выдержать **1000+ одновременных пользователей** (оптимизация фронта и сборки).
- **Разнести всё по папкам:** блоки — свои папки, изображения — по блокам и общим.
- **Максимально оптимизировать** веб-приложение (бандл, загрузка, рендер).
- **Единые правила:** имена файлов — латиница, без пробелов и кириллицы; preload ключевых ресурсов; учёт хостинга и CDN; замер метрик после изменений.

---

## ЭТАП 1 — Реорганизация папок компонентов (блоки по папкам)

**Суть:** У каждого блока своя папка. Внутри — компонент (ссылки на ассеты — из своих папок в `assets/sections/`).

**Текущее состояние:** Все секции в `src/components/` вместе с NavBar, PrivacyModal, NavLink и 40 UI-компонентами.

**Целевая структура:**

```
src/
  components/
    sections/
      hero/
        HeroSection.tsx
      certification/
        CertificationSection.tsx
      transparency/
        TransparencySection.tsx
      cargo/
        CargoSection.tsx
      china-partners/
        ChinaPartnersSection.tsx
      delivery/
        DeliverySection.tsx
      storage/
        StorageBlock.tsx
      about/
        AboutSection.tsx
      insurance/
        InsuranceBlock.tsx
      why/
        WhySection.tsx
      testimonials/
        TestimonialsSection.tsx
      faq/
        FaqSection.tsx
    layout/
      NavBar.tsx
      FooterSection.tsx
      NavLink.tsx
    modals/
      PrivacyModal.tsx
    ui/                    # без изменений
      accordion.tsx
      ...
```

**Действия:**

- Создать папки `sections/*`, `layout/`, `modals/`.
- Перенести компоненты, обновить импорты в `Index.tsx` и везде, где они используются (в т.ч. модалки, футер).
- Проверить сборку и линтер.

**Результат:** Понятная структура: один блок — одна папка.

---

## ЭТАП 2 — Реорганизация ассетов (по блокам + общие + unassigned)

**Суть:** Изображения и медиа — в папках по блокам; общие (логотип, шрифты) — в `shared`. **Имена файлов — только латиница, без пробелов и спецсимволов** (одобренная рекомендация).

**Текущее состояние:** Часть в корне `assets/`, часть в `delivery-routes/`, `otzyvy/`, `videos/`, `fonts/`; много файлов без привязки к блоку.

**Целевая структура:**

```
src/assets/
  shared/
    logo.png              # бывший "ChatGPT Image 19 февр..."
    fonts/
      BebasNeue-Bold.otf
  sections/
    hero/
      hero-banner.png     # IMG_9848-2.PNG
    certification/
      market.png          # IMG_0012.PNG
      ozon.png            # IMG_0010.PNG
      wb.png              # IMG_0005-2.png
      icon.png            # IMG_9999-2.png
    cargo/
      cargo-main.jpg
      slide-1.png, slide-2.png, slide-3.png
    china-partners/
      partners-bg.png
    delivery/
      plane.png, express.png, train.png, truck.png, ship.png
    insurance/
      deco-left.png, deco-right.png
    why/
      video-control.mp4, video-warehouse.mp4, video-process.mp4, video-control2.mp4
    testimonials/
      photo-01.jpeg … photo-18.jpeg
    faq/
      cta-bg.jpg
  unassigned/             # не привязаны к блоку; судьба — на Этапе 4
    img-9844-2.png
    hero-diorama.jpg
    transport-ship.jpg, transport-truck.jpg, transport-train.jpg,
    transport-plane.jpg, transport-express.jpg
    img-9862.png, images-2.jpg
    ozon-icon-logo.png, wildberries-sign-logo.png
    icon-snu7tps.png, icon-3296.png
    photo-2026-02-20-15-07-03.png
    image-2026-02-24.jpg, image-2026-02-20-16-10-43.png
    image-2026-02-20-14-08-07.png, image-2026-02-20-14-08-07.jpg
    image-2026-02-20-14-04-28.jpg, image-2026-02-20-15-01-16.jpg
    image-2026-02-19-16-09-49.jpg, image-2026-02-19-18-45-54.jpg
    delivery-9851.jpg, delivery-9850001.png
```

**Действия:**

- Создать `assets/sections/<block>/`, `assets/shared/`, `assets/unassigned/`.
- Перенести и **переименовать** файлы в латиницу без пробелов (как в таблице выше).
- Обновить все импорты в компонентах (с учётом новой структуры из Этапа 1).
- Логотип — один файл `shared/logo.png`, использовать в NavBar и Footer.

**Результат:** У каждого блока свой набор ассетов; общее в `shared`; неиспользуемые в `unassigned` для решения на Этапе 4.

---

## ЭТАП 3 — Оптимизация под высокую нагрузку (1000+ пользователей)

**Важно:** Нагрузку в первую очередь держит **хостинг и CDN** (одобренная рекомендация: статику раздавать через CDN — Vercel, Netlify, Cloudflare Pages — со сжатием gzip/brotli и кэшированием). Фронт делаем лёгким: быстрая загрузка и меньше нагрузки на браузер.

**3.1. Разбиение бандла (code splitting)**

- **Ленивая загрузка секций:** `React.lazy()` + `Suspense` для блоков ниже первого экрана (Certification, Transparency, Cargo, ChinaPartners, Delivery, Storage, About, Insurance, Why, Testimonials, FAQ).
- Hero + NavBar загружать сразу.
- В `vite.config.ts`: `build.rollupOptions.output.manualChunks` — вынести `react`, `react-dom`, `react-router-dom`, `@tanstack/react-query` в vendor-чанк.
- `chunkFileNames`, `assetFileNames` — с хешами для долгого кэша.

**3.2. Оптимизация медиа**

- Изображения: где нужен только URL — импорт с `?url`; тяжёлые картинки ниже fold — `loading="lazy"`.
- Видео в WhySection: не грузить все 4 сразу; по одному при показе или `preload="metadata"`.
- Критичные (Hero, логотип) — в сборке, при необходимости предварительно сжать.

**3.3. Preload ключевых ресурсов (одобренная рекомендация)**

- Preload для шрифта и Hero-картинки делается **плагином сборки** (в `vite.config.ts`), а не статичными тегами в `index.html`: итоговые имена файлов с хешами известны только после `generateBundle`. Плагин в хуке `generateBundle` собирает имена, в `writeBundle` — дописывает `<link rel="preload">` в собранный `index.html`.
- Критичные ресурсы: шрифт `BebasNeue-Bold.otf` (или аналог в `shared/fonts/`), главное изображение Hero (`hero-banner.png` в `sections/hero/`). **При переименовании этих файлов** нужно обновить логику плагина (поиск по подстроке имени в `fileName`).
- Цель — быстрее отрисовка первого экрана.

**3.4. Сборка и статика**

- Подключить **vite-plugin-compression** (gzip и/или brotli) для артефактов сборки.
- Убедиться, что в production не подключаются dev-плагины (lovable-tagger только в dev).

**3.5. Рендер**

- Тяжёлые вычисления — в `useMemo`/`useCallback`; при необходимости мемоизация списков.
- Модалки (Privacy) — рендер только при открытии.

**Действия:**

- Изменить `vite.config.ts`: manualChunks, compression, chunkFileNames, assetFileNames.
- Обновить `Index.tsx`: lazy-импорт секций + общий `Suspense` с fallback (скелетон или минимальный лоадер).
- Реализовать preload через плагин сборки (инжекция в собранный `index.html` после генерации бандла).
- Проверить импорты картинок/видео и при необходимости `loading="lazy"` для img ниже fold.
- Сборка, проверка размера чанков и времени загрузки.

**Результат:** Меньший начальный бандл, быстрый первый экран, статика готова к раздаче через CDN.

---

## ЭТАП 4 — Чистка кода, консистентность и метрики

**Суть:** Единый стиль, удаление неиспользуемого, доступность, решение по `unassigned`. **Метрики** (одобренная рекомендация) — замерить результат оптимизаций.

**4.1. Код и структура**

- Удалить неиспользуемые импорты и хуки.
- У всех секций — осмысленные `aria-label` / `id`.
- Проверить реальные опечатки в классах Tailwind (если есть). Обозначения вида `min-h-.creen`, `ection-.pacing` в инструментах (DOM Path и т.п.) — это артефакты отображения/кодирования буквы «s», в исходном коде классы уже корректны (`min-h-screen`, `section-spacing`).
- **При рефакторинге не менять логику скролла в CargoSection** (пороги, `preventDefault`, смена слайдов): эта логика тонко настроена; менять только с ручной проверкой поведения.

**4.2. Судьба `unassigned` и оставшихся ассетов в корне `assets/`**

- Сейчас часть файлов всё ещё в `assets/` (корень) и в `assets/delivery-routes/` с исходными именами; папка `unassigned/` есть с README, но туда не всё перенесено.
- Разделить: (1) **используемые** — привязать к блокам в `sections/<block>/` и обновить импорты; (2) **действительно неиспользуемые** — перенести в `assets/unassigned/` с кратким README или удалить из репо.
- Итог: в корне `assets/` только `shared/`, `sections/`, `unassigned/` (и при необходимости `delivery-routes/` до переноса в секции).

**4.3. Метрики (одобренная рекомендация)**

- После всех этапов замерить:
  - размер бандла (до/после), размер основных чанков;
  - First Contentful Paint (FCP), Time to Interactive (TTI).
- Один раз прогнать Lighthouse (вручную или в CI) и **сохранить отчёт** (например `docs/lighthouse-report.json` или скрин в репо), чтобы эффект оптимизаций был задокументирован.
- Опционально: при деплое на Vercel/Netlify включить Lighthouse в preview-сборках.

**4.4. Зависимости (дополнение по опыту)**

- Проверить `package.json`: неиспользуемые зависимости (например `npx depcheck`), устаревшие версии, `npm audit` по уязвимостям.

**Действия:**

- Точечные правки по файлам, линтер, сборка.
- Решение по оставшимся ассетам в корне и в `delivery-routes/`: привязка к блокам или перенос в `unassigned/` + README.
- Замер и запись метрик (Lighthouse, размеры бандлов), сохранение отчёта.
- При необходимости — проверка зависимостей.

**Результат:** Чистая кодовая база, предсказуемая структура, задокументированный эффект оптимизаций.

---

## Сводная таблица этапов

| Этап | Содержание | Зависимости |
|------|------------|-------------|
| **1** | Папки компонентов: sections, layout, modals | — |
| **2** | Папки ассетов: sections/*, shared, unassigned; имена файлов — латиница | После 1 (удобнее править импорты разом) |
| **3** | Нагрузка: lazy, chunks, compression, preload, медиа | После 1–2 |
| **4** | Чистка, доступность, судьба unassigned, метрики | После 1–2, идеально после 3 |

**Утверждённая последовательность:** 1 → 2 → 3 → 4.

---

## Корректировки по опыту выполнения этапов 1–3

- **Preload (этап 3):** В плане изначально было «добавить preload в index.html». На практике preload делается **кастомным плагином Vite**: хеши имён файлов известны только после сборки, поэтому в плане и в п. 3.3 указано, что preload инжектируется плагином в собранный `index.html`. При переименовании критичных ассетов (шрифт, hero-banner) нужно обновлять условия в плагине в `vite.config.ts`.
- **Опечатки в классах (этап 4):** Обозначения вроде `min-h-.creen` в DOM Path / инструментах — это отображение буквы «s» как точки, в исходном коде классы уже корректны. В 4.1 уточнено: искать реальные опечатки в Tailwind-классах.
- **CargoSection:** Логика скролла (пороги, блокировка прокрутки страницы, смена слайдов) тонко настроена. В 4.1 добавлено предупреждение: при рефакторинге эту логику не менять без ручной проверки.
- **Unassigned и корень assets:** После этапа 2 часть файлов остаётся в корне `assets/` и в `assets/delivery-routes/`. В 4.2 уточнено: явно разделить «привязать к блокам» и «перенести в unassigned или удалить», чтобы в корне остались только `shared/`, `sections/`, `unassigned/`.
- **Метрики:** В 4.3 добавлено: сохранять отчёт Lighthouse (файл или скрин в репо) и опционально — запуск Lighthouse в preview при деплое.
- **Зависимости:** Добавлен п. 4.4 — проверка неиспользуемых и устаревших зависимостей (`depcheck`, `npm audit`).

---

## Включённые одобренные рекомендации

| Рекомендация | Где учтена |
|--------------|------------|
| Имена файлов — латиница, без пробелов и кириллицы | Этап 2 (структура ассетов и переименование) |
| Preload ключевых ресурсов (шрифт, Hero) | Этап 3 (п. 3.3) |
| Хостинг и CDN для 1000+ пользователей | Этап 3 (вводная часть и п. 3.4) |
| Метрики после изменений (бандл, FCP, TTI, Lighthouse) | Этап 4 (п. 4.3) |
| Критичный CSS (опционально) | Можно добавить в Этап 3 при необходимости — отдельным подпунктом |

---

Документ можно использовать как единственный источник правды при выполнении работ. Каждый этап выполняется по очереди после завершения предыдущего.
